/**
 * skylark-texts-plain - The skylarkjs plain utility Library.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["skylark-langx/Evented","./plain","./leaf_chunk"],function(e,i,n){var h=e.inherit({klassName:"BranchChunk",_construct:function(e){this.children=e;for(var i=0,n=0,h=0;h<e.length;++h){var t=e[h];i+=t.chunkSize(),n+=t.height,t.parent=this}this.size=i,this.height=n,this.parent=null},chunkSize:function(){return this.size},removeInner:function(e,i){this.size-=i;for(var h=0;h<this.children.length;++h){var t=this.children[h],r=t.chunkSize();if(e<r){var l=Math.min(i,r-e),s=t.height;if(t.removeInner(e,l),this.height-=s-t.height,r==l&&(this.children.splice(h--,1),t.parent=null),0==(i-=l))break;e=0}else e-=r}if(this.size-i<25&&(this.children.length>1||!(this.children[0]instanceof n))){var a=[];this.collapse(a),this.children=[new n(a)],this.children[0].parent=this}},collapse:function(e){for(var i=0;i<this.children.length;++i)this.children[i].collapse(e)},insertInner:function(e,i,h){this.size+=i.length,this.height+=h;for(var t=0;t<this.children.length;++t){var r=this.children[t],l=r.chunkSize();if(e<=l){if(r.insertInner(e,i,h),r.lines&&r.lines.length>50){for(var s=r.lines.length%25+25,a=s;a<r.lines.length;){var c=new n(r.lines.slice(a,a+=25));r.height-=c.height,this.children.splice(++t,0,c),c.parent=this}r.lines=r.lines.slice(0,s),this.maybeSpill()}break}e-=l}},maybeSpill:function(){if(!(this.children.length<=10)){var e=this;do{var i=e.children.splice(e.children.length-5,5),n=new h(i);if(e.parent){e.size-=n.size,e.height-=n.height;var t=indexOf(e.parent.children,e);e.parent.children.splice(t+1,0,n)}else{var r=new h(e.children);r.parent=e,e.children=[r,n],e=r}n.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()}},iterN:function(e,i,n){for(var h=0;h<this.children.length;++h){var t=this.children[h],r=t.chunkSize();if(e<r){var l=Math.min(i,r-e);if(t.iterN(e,l,n))return!0;if(0==(i-=l))break;e=0}else e-=r}}});return i.BranchChunk=h});
//# sourceMappingURL=sourcemaps/branch_chunk.js.map
